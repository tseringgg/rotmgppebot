var fail,uid;$.fn.blindLeftIn=function(t,e,n){return this.animate({marginLeft:0},$.speed(t,e,n))},$.fn.blindLeftOut=function(t,e,n){return this.animate({marginLeft:-this.outerWidth()},$.speed(t,e,n))},window.storage=!1;try{uid=new Date,(window.storage=window.localStorage).setItem(uid,uid),fail=storage.getItem(uid)!=uid,storage.removeItem(uid),fail&&(window.storage=!1)}catch(t){}window.console||(window.console={log:function(){}}),$.timeago.settings.allowFuture=!0,window.classInfoById={};for(var i=0;i<classInfos.length;++i)classInfoById[classInfos[i][0]]=classInfos[i];function statsTable(k,S,x,I,C){var T=['<table class="stats-table">'],D=["HP","MP","ATT","DEF","SPD","VIT","WIS","DEX"];function t(t,e){var n=!0;T.push("<tr>");for(var a=t;a<=e;++a){s=r=i=o=void 0;var o=D[a],i=x[a],r=k[a],s=S[a];T.push("<td"),i&&T.push(' class="maxed"'),T.push(">"),T.push(o),T.push(": "),T.push(r),0!==s&&(T.push("("),0<s&&T.push("+"),T.push(s),T.push(")")),T.push("</td>"),n&=x[a]}if(P(t,e),T.push("</tr>"),!n){var c=t,l=e;T.push("<tr>");for(var u=c;u<=l;++u){d=void 0;p=void 0;f=void 0;h=void 0;var d=x[u];var p=k[u];var f=S[u];var h=C[u];p=p-f-h;T.push('<td class="from-avg'+(p<0?" below-avg":" above-avg")+'">'),d||(0==p?T.push("average"):(0<p&&T.push("+"),T.push(p),T.push(" from avg")));T.push("</td>")}P(c,l),T.push("</tr>");var c=t,m=e;T.push("<tr>");for(var g=c;g<=m;++g){v=void 0;w=void 0;b=void 0;$=void 0;y=void 0;var v=D[g];var w=x[g];var b=k[g];var $=S[g];var y=I[g];T.push('<td class="to-max">'),w||(T.push(y-b+$),"HP"!=v&&"MP"!=v||(T.push(" ("),T.push(Math.ceil((y-b+$)/5)),T.push(")")),T.push(" to max"));T.push("</td>")}P(c,m),T.push("</tr>")}}function P(t,e){for(var n=0;n<3-(e-t+1);++n)T.push("<td></td>")}return t(0,1),t(2,4),t(5,7),T.push("</table>"),T.join("")}function renderStats(t){$("#"+t+" .player-stats").each(function(){var t=$(this),e=[0,1,2,3,4,6,7,5],n=JSON.parse(t.attr("data-stats")),a=JSON.parse(t.attr("data-bonuses")),o=JSON.parse(t.attr("data-class")),i=JSON.parse(t.attr("data-level")),r=JSON.parse(t.attr("data-maxed-stats")),o=classInfoById[o],s=o[5],c=$.map(e,function(t){return s[t]}),l=$.map(e,function(t,e){return!!(r>>4&1<<7-e)}),u=15&r,d=o[4],p=o[3],f=$.map(d,function(t,e){return p[e]+t*(i-1)}),f=$.map(e,function(t){return f[t]});t.html(u+'/8 <i class="glyphicon glyphicon-info-sign"></i>'),t.popover({html:!0,content:statsTable(n,a,l,c,f),trigger:"manual",template:'<div class="popover"><div class="arrow"></div><div class="popover-inner"><div class="popover-content"><p></p></div></div></div>'}),t.parent().hover(function(){t.popover("show")},function(){t.popover("hide")})})}function alternativesTable(t){var n='<table class="alternatives-table"><thead><tr><th>Server</th><th>Price</th><th>Quantity</th><th>Time Left</th></tr></thead><tbody>';return $.each(t,function(t,e){n+="<tr>",$.each(e,function(t,e){n+="<td>",3==t?2147483647!=e?n=(n+="<")+(e+1)+" min":n+="new":n+=e,n+="</td>"}),n+="</tr>"}),n+="</tbody></table>"}function renderAlternatives(t,e){$("#"+t+" .cheapest-server").each(function(){var t=$(this),e=JSON.parse(t.attr("data-alternatives"));0<e.length&&(t.append(' <i class="glyphicon glyphicon-info-sign"></i>'),t.popover({html:!0,content:alternativesTable(e),trigger:"manual",title:"Other servers",placement:"left"}),t.parent().hover(function(){t.popover("show")},function(){t.popover("hide")}))})}function linkForItem(t){var e=items[t]||items[-1];return 0!==e[1]&&10!==e[1]&&26!==e[1]||3180===t||-256===t||65280===t?"/wiki/"+e[0].toLowerCase().replace(/[^a-z0-9-]/g,"-").replace(/--+/g,"-").replace(/^-|-$/g,""):null}function renderItems(t){makeItemsIn($("#"+t)).each(function(){$(this).wrap(function(){var t=linkForItem($(this).attr("data-item"));return null!=t&&'<a href="'+t+'" target="_blank"/>'})})}function makeItemsIn(t){return $(".item",t).each(function(){makeItem($(this))})}function renderItemTable(t){return['<table class="stats-table"><tbody><tr><td>Fame Bonus:</td><td>',t[5],"%</td></tr><tr><td>Feed Power:</td><td>",t[6],"</td></tr></tbody></table>"].join("")}function makeItem(t){var e=items[t.attr("data-item")]||items[-1],n=10==e[1]||0==e[1]||26==e[1]?"":-1==e[2]?" UT":" T"+e[2];e[7]&&t.prepend('<span class="token-amount">'+e[7]+"</span>"),t.css("background-position","-"+e[3]+"px -"+e[4]+"px").popover({title:e[0]+n,trigger:"hover",container:"body",placement:function(t,e){return $(e).offset().top-$(window).scrollTop()<110?"bottom":"top"},html:!0,content:renderItemTable(e)})}function renderPets(t){$("#"+t+" .pet").each(function(){var t=$(this),e=items[t.attr("data-item")];e&&t.css("background-position","-"+e[1]+"px -"+e[2]+"px").attr("title",e[0])})}function renderArticle(t,e){renderItems(t),$("#"+t+" td:nth-child("+e+") .item").each(function(){var t=$(this),e=items[t.attr("data-item")]||items[-1];t.closest("td").next().text(e[0])})}function renderNumeric(t,e,n){t=$("#"+t+" td:nth-child("+e+")");t.map(function(){for(var t=$(this);t.children().length;)t=$(t.children()[0]);return t}).text(function(t,e){return $(this).closest("td").data("value",e),formatNumber(e)}),n||t.hover(function(){showDiffs($(this))},function(){hideDiffs($(this))})}function showDiffs(t){var a=t.data("value");siblingsDo(t,25,function(t,e){var n;""!=e&&(n='<span class="diff"><span',(e=e-a)<0?n+=' class="diff-smaller">-':0<e&&(n+=' class="diff-bigger">+'),e%1!=0&&(e=e.toFixed(1)),n+=formatNumber(Math.abs(e)),this.append(n+="</span>"))})}function hideDiffs(t){siblingsDo(t,25,function(){$(".diff",this).remove()})}function siblingsDo(t,e,n){siblingsSelectedDo(t,e,function(t){return t.prev()},n),siblingsSelectedDo(t,e,function(t){return t.next()},n)}function siblingsSelectedDo(t,e,n,a){for(var o=t.parent(),i=t.index(),r=0;r<e&&(o=n(o)).length;++r){var s=o.find("td:nth-child("+(i+1)+")"),c=s.data("value");a.call(s,r+1,c)}}function formatNumber(t){var e=/(\d+)(\d{3})/;for(t+="";e.test(t);)t=t.replace(e,"$1â€‰$2");return t}function formatTimeLeft(t,e){$("#"+t+" td:nth-child("+e+")").text(function(t,e){e=parseInt(e);return 2147483647==e?"new":0==e?"<1 minute":"<"+(e+1)+" minutes"})}function makeSortable(t,e){$("#"+t).tablesorter({headers:e})}function bookmarkPlayer(t){bookmarkName(t,"players")}function bookmarkGuild(t){bookmarkName(t,"guilds")}function bookmarkName(t,e){var n,a;storage&&(n=(n=storage[e])?JSON.parse(n):[],-1!=(a=$.inArray(t,n))&&n.splice(a,1),n.unshift(t),n.splice(200,n.length-200),storage[e]=JSON.stringify(n))}window.rankBoundaries=[];for(var n=window.classInfos.length,i=n-1;i<=5*n;i+=n)window.rankBoundaries.push(i);function colorForRank(n){var a;return $.each(window.rankBoundaries,function(t,e){if(n<=e)return a=window.rankColors[t],!1}),a||window.rankColors[window.rankColors.length-1]}function renderDonationPopover(t,e){var n,a,t=$("#"+t+" img"),o=t.parent().prev().text(),i=t.attr("src"),r=i.slice(0,-1*"crown-place.png".length)+"crown.png";if(e.length){function s(t){a+='<span class="timeago" title="'+e[t]+'"></span>'}n="Thanks "+o+"!",a="<span>"+o+" donated ",s(0);for(var c=1;c<e.length-1;++c)a+=", ",s(c);1<e.length&&(a+=" and ",s(e.length-1)),a+="</span>",a=$(a),$(".timeago",a).timeago()}else n=o+" hasn't donated yet.",a="Click on the crown to donate",t.hover(function(){$(this).attr("src",r)},function(){$(this).attr("src",i)});t.popover({html:!0,title:n,content:a,trigger:"hover"})}function addSearch(t,n,e){var a,o=$("#"+t);storage&&(a=(a=storage[e])&&JSON.parse(storage[e])),o.typeahead({highlight:!0},{displayKey:function(t){return t},source:function(t,e){e(typeaheadFilter(t,a))}}).on("typeahead:selected",function(t,e){window.location.pathname=n+"/"+encodeURIComponent(e)}).keypress(function(t){13==t.which&&(window.location.pathname=n+"/"+encodeURIComponent($(o).val()))})}function addPlayerSearch(t){addSearch(t,"/player","players")}function addGuildSearch(t){addSearch(t,"/guild","guilds")}function initializeSearch(t,e){var n=$("#"+e),a=$("#"+t),o=($(".player-guild-toggle-panel",a),$("input[type=text]",a)),e=$("label",a),i=($(".btn-group",a),$(".auth-panel")),r=!0,s="Player",c={Player:[],Guild:[]};storage&&(c.Player=JSON.parse(storage.players||"[]"),c.Guild=JSON.parse(storage.guilds||"[]")),n.click(function(){i.animate({opacity:0},"fast",null,function(){i.hide()}),n.animate({opacity:0},"fast",null,function(){n.hide(),a.show(),a.animate({opacity:1},"fast"),o.focus()}),o.attr("placeholder",s+" search"),r=!0}),o.focus(function(){r=!0,o.attr("placeholder",s+" search")}).blur(function(){r&&a.animate({opacity:0},"fast",null,function(){a.hide(),n.show(),n.animate({opacity:1},"fast"),i.show(),i.animate({opacity:1},"fast")})}).typeahead({highlight:!0},{displayKey:function(t){return t},source:function(t,e){e(typeaheadFilter(t,c[s]))}}).on("typeahead:selected",function(t,e){return window.location.pathname="/"+("Player"==s?"player":"guild")+"/"+encodeURIComponent(e),!0}).keypress(function(t){13==t.which&&(window.location.pathname="/"+s.toLowerCase()+"/"+encodeURIComponent(o.val()))}),e.mousedown(function(){r=!1}).click(function(){s=$(this).text(),o.trigger("focus")}).button()}function typeaheadFilter(t,e,n){n=n||9;var a=[],t=filterQuery(t),o=t.toLowerCase(),i=(e&&$.each(e,function(t,e){-1!=(t=e.toLowerCase().indexOf(o))&&(a[t]?a[t].push(e):a[t]=[e])}),[t]);return $.each(a,function(t,e){!e||n<i.length||(e.sort(),$.each(e,function(t,e){n<i.length||i.push(e)}))}),i}function filterQuery(t){return t.replace(/^\s+|\s+$/g,"").replace(/ +/g," ")}function indicateSelectedItem(){$(window.location.hash).parent().css("border-left","3px solid #777")}function makeChooserRedirector(t,e){$("#"+t).change(function(){window.location.pathname=e+$(this).val()})}function addAnchorsInDescription(t,e){var n=new RegExp("(https?:\\/\\/)?(www\\.)?(youtube\\.com|youtu\\.be|imgur\\.com|i\\.imgur\\.com|puu\\.sh|twitch\\.tv|reddit\\.com|redd\\.it|github\\.com|community\\.kabam\\.com|realmeye\\.com|bluenosersguide\\.weebly\\.com|pfiffel\\.com|kitsu\\.io)(\\/[\\w\\/\\.\\?=&;_-]+)?"+(e?"|"+e:""),"gi"),e=$("#"+t);$(".description-line",e).each(function(){$(this).html($(this).html().replace(n,function(t){var e=t,n=(/^https?:\/\//.test(t)||(e="http://"+t),/realmeye\.com/.test(t)?' rel="nofollow"':' rel="nofollow external"');return'<a href="'+encodeURI(e)+'"'+n+">"+t+"</a>"}))})}function renderMail(t){$("#"+t).attr("href",$.map([109,97,105,108,116,111,58,105,110,102,111,64,114,101,97,108,109,101,121,101,46,99,111,109],function(t){return String.fromCharCode(t)}).join(""))}function initializeLoginButton(t){$("#"+t).click(function(){$(this).button("loading")})}function initializeLogin(t,o){var t=$("#"+t),i=$("button",t),r=!1,s=$("form",t);i.click(function(){s.trigger("submit")}),$("input").keypress(function(t){13==t.which&&(t.preventDefault(),s.trigger("submit"))}),s.submit(function(t){var e,n,a;return i.button("loading"),!!r||(e=$(":input[name=username]",s).val(),n=$(":input[name=password]",s).val(),a=$(":input[name=bindToIp]",s).is(":checked")?"t":"f",e&&n?(callSpec(o,{username:e,password:n,bindToIp:a}).done(function(t,e,n){"OK"==t?(r=!0,s.submit()):(i.button("reset"),$("#wrong-password .alert-danger").text("Invalid username or password!"),$("#wrong-password").removeClass("hide"))}).fail(function(){i.button("reset"),$("#wrong-password .alert-danger").text("An error occured. Please try again!"),$("#wrong-password").removeClass("hide")}),void t.preventDefault()):(i.button("reset"),!1))})}function initializeLogout(t){$("#"+t).click(function(t){var n=window.location.pathname;$.ajax({type:"POST",url:"/logout"}).done(function(t){var e=n.indexOf("#");-1!=e&&(n=n.slice(0,e)),window.location.href=n})})}function initializeEditDescription(t,e){var n=$("#"+t+" > button"),a=$("#"+t+" .modal");n.click(function(){a.modal("show")}),$("button",a).click(function(){var t={};$.each(["line1","line2","line3"],function(){t[this]=$("input[name="+this+"]",a).val()}),callSpecAndReload(e,t)})}function initializeClickHandlerWithAction(t,e){$("#"+t).click(function(){callSpecAndReload(e)})}function petAbilityTable(t,e,n,a,o){var i=['<table class="stats-table pet-ability-stats-table">'];return r("Level:",t),r("Points:",n),t!=e&&(r('<abbr title="Feed power needed for Next Level">Next</abbr>:',a+" fp"),r('<abbr title="Feed power needed for Max Level('+e+')">Max</abbr>:',o+" fp")),i.push("</table>"),i.join("");function r(t,e){i.push("<tr><td>"),i.push(t),i.push("</td><td>"),i.push(formatNumber(e)),i.push("</td></tr>")}}function renderPetAbilityPopover(t,e,n){$("#"+t+" td:nth-child("+e+") .pet-ability").each(function(){var t=$(this),e=t.data("pet-ability");t.html(e[1]+' <i class="glyphicon glyphicon-info-sign"></i>'),t.popover({title:e[0],html:!0,content:petAbilityTable(e[1],e[2],e[3],e[4],e[5]),trigger:"click"})})}function completeData(t){var e=document.cookie.match(/session=([0-9a-zA-Z]+)/);return e&&e[1]&&(t.session=e[1]),t}function callSpec(t,e){return $.extend(t.data,e),completeData(t.data),$.ajax(t)}function callSpecAndReload(t,e,n){var a=window.location.href;callSpec(t,e).done(function(t){n&&!n(t)||(-1!=(t=a.indexOf("#"))&&(a=a.slice(0,t)),window.location.href=a)})}function initializeCookieConsentBanner(e){$("body").css("padding-bottom","25px"),$("#"+e+" .btn-primary").click(function(){var t=new Date;t.setYear(t.getFullYear()+1),document.cookie="gdprCookiePolicyAccepted=true;path=/;expires="+t.toUTCString(),/gdprCookiePolicyAccepted=true/.test(document.cookie)||(alert("Your browser does not allow us to store this data for a longer time in a cookie. Your choice will only be in effect during this browsing session."),document.cookie="gdprCookiePolicyAccepted=true;path=/"),$("#"+e).remove()})}function convertToLocalTime(t){t.text(function(t,e){return e?[(e=new Date(e)).getFullYear(),"-",padWithZeros(e.getMonth()+1,2),"-",padWithZeros(e.getDate(),2)," ",padWithZeros(e.getHours(),2),":",padWithZeros(e.getMinutes(),2)].join(""):""})}function convertElementByIdToLocalTime(t){convertToLocalTime($("#"+t))}function convertColumnToLocalTime(t,e){convertToLocalTime($("#"+t+" td:nth-child("+e+")"))}function padWithZeros(t,e){return(t+="").length>=e?t:new Array(e-t.length+1).join("0")+t}function initializeAlertCloseButton(t,e){$("#"+t).click(function(){document.cookie="closedAlertVersion="+e+";path=/;expires=Wed, 01 Jan 2037 00:00:00 GMT; Secure; SameSite=Strict"})}window.rankBoundaries.push(5*window.classInfos.length),window.rankColors=["light-blue","blue","red","orange","yellow","white"],$.tablesorter.addParser({id:"guildRank",is:function(t){return!1},format:function(t){switch(t){case"Founder":return 5;case"Leader":return 4;case"Officer":return 3;case"Member":return 2;case"Initiate":return 1;default:return 0}},type:"numeric"}),$.tablesorter.addParser({id:"petRarity",is:function(t){return!1},format:function(t){switch(t){case"Divine":return 5;case"Legendary":return 4;case"Rare":return 3;case"Uncommon":return 2;case"Common":return 1;default:return 0}},type:"numeric"}),$.tablesorter.addParser({id:"accountCreated",is:function(t){return!1},format:function(t,e,n){return $("span",n).data("rank")},type:"numeric"}),$.tablesorter.addParser({id:"guildStarDistribution",is:function(t){return!1},format:function(t,e,n){return $(".guild-star-distribution",n).data("sorter")},type:"numeric"}),$(function(){function t(){$(".table-responsive").each(function(){var t=!!$(".scroll-alert",this).length;this.scrollWidth>this.clientWidth?t||$("table",this).before('<small style="margin-left: 4px" class="label label-default scroll-alert">Scroll the table horizontally to see all columns!</small>'):t&&$(".scroll-alert",this).remove()})}$("span.numeric").text(function(t,e){return formatNumber(e)}),$("span.timeago").timeago(),$("ul.dropdown-menu [data-toggle=dropdown]").on("click",function(t){t.preventDefault(),t.stopPropagation(),$("ul.dropdown-menu [data-toggle=dropdown]").parent().removeClass("open"),$(this).parent().addClass("open")}),$(window).on("resize",t),t()}),window.RealmEye={converter:function(){return this.converterObject||(this.converterObject=new Showdown.converter)},sanitizer:function(){return this.sanitizerObject||(this.sanitizerObject=new Sanitize(Sanitize.Config.RELAXED))},sanitize:function(t,e){e=this.converter().makeHtml(e||t.text()),e=$("<div>"+e+"</div>"),e=this.sanitizer().clean_node(e[0]);t.empty().append(e)},initializeEditor:function(e,n,a,t,o,i){function r(){a.is(":checked")?(t.addClass("markdown"),RealmEye.sanitize(t,e.val())):(t.removeClass("markdown"),t.text(e.val()))}e.data("ajaxSpec")!==o&&(e.data("ajaxSpec",o),e.off(),n.off(),a.off(),o.data.body&&e.val(o.data.body),a.prop("checked","t"==o.data.markdown),a.change(r),e.on("input propertychange",r),n.click(function(){n.attr("disabled","disabled").addClass("disabled").off();var t={body:e.val(),markdown:a.is(":checked")?"t":"f"};i&&i(t),callSpecAndReload(o,t)}),r())}};